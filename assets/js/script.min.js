const navbar=document.querySelector(".navbar"),navToggle=document.querySelector(".navbar__toggle"),navMenu=document.querySelector(".navbar__menu"),navLinks=document.querySelectorAll(".navbar__link"),backToTopBtn=document.getElementById("back-to-top"),initTheme=()=>{const e=localStorage.getItem("theme")||"light";document.documentElement.setAttribute("data-theme",e)};navToggle&&navToggle.addEventListener("click",()=>{navToggle.classList.toggle("active"),navMenu.classList.toggle("active");const e="true"===navToggle.getAttribute("aria-expanded");navToggle.setAttribute("aria-expanded",!e)}),navLinks.forEach(e=>{e.addEventListener("click",()=>{navToggle&&(navToggle.classList.remove("active"),navMenu.classList.remove("active"),navToggle.setAttribute("aria-expanded","false"))})});let lastScrollTop=0;const handleNavbarScroll=()=>{if(!navbar)return;const e=window.scrollY??document.documentElement.scrollTop;e>50?navbar.classList.add("scrolled"):navbar.classList.remove("scrolled"),lastScrollTop=e};document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=document.querySelector(this.getAttribute("href"));if(t){const e=t.getBoundingClientRect().top+window.scrollY-80;window.scrollTo({top:e,behavior:"smooth"})}})});const sections=document.querySelectorAll("section[id]"),highlightNavOnScroll=()=>{const e=window.scrollY;sections.forEach(t=>{const s=t.offsetHeight,a=t.offsetTop-100,i=t.getAttribute("id"),r=document.querySelector(`.navbar__link[href="#${i}"]`);e>a&&e<=a+s&&(navLinks.forEach(e=>e.classList.remove("active")),r&&r.classList.add("active"))})},handleBackToTop=()=>{window.scrollY>300?(backToTopBtn?.classList.remove("hidden"),backToTopBtn?.classList.add("block")):(backToTopBtn?.classList.add("hidden"),backToTopBtn?.classList.remove("block"))};backToTopBtn&&backToTopBtn.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})});const observerOptions={threshold:.1,rootMargin:"0px 0px -50px 0px"},observer=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting&&(e.target.classList.add("revealed"),e.target.classList.contains("timeline-item"))){e.target.classList.add("visible");const t=100*Array.from(e.target.parentNode.children).indexOf(e.target);e.target.style.transitionDelay=`${t}ms`}})},observerOptions),animateElements=()=>{document.querySelectorAll(".scroll-reveal, .card").forEach(e=>{observer.observe(e)})},initializeTimeline=()=>{document.querySelectorAll(".timeline-item").forEach(e=>{e.classList.add("fade-in-up"),observer.observe(e)})},openSidePanel=e=>{const t=document.getElementById(e),s=document.getElementById("panel-overlay");if(t&&s){t.classList.add("active"),s.classList.add("active"),t.setAttribute("aria-hidden","false");const e=document.querySelector("main"),a=document.querySelector(".navbar");e&&e.setAttribute("inert",""),a&&a.setAttribute("inert","");const i=t.querySelector(".panel-close");i&&i.focus();const r=t.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),n=r[0],o=r[r.length-1];t._trapFocus=e=>{"Tab"===e.key&&(e.shiftKey?document.activeElement===n&&(e.preventDefault(),o.focus()):document.activeElement===o&&(e.preventDefault(),n.focus()))},t.addEventListener("keydown",t._trapFocus),document.addEventListener("keydown",handlePanelEscapeKey),document.body.style.overflow="hidden"}},closeSidePanel=e=>{const t=document.getElementById(e),s=document.getElementById("panel-overlay");if(t&&s){t.classList.remove("active"),s.classList.remove("active"),t.setAttribute("aria-hidden","true");const a=document.querySelector("main"),i=document.querySelector(".navbar");a&&a.removeAttribute("inert"),i&&i.removeAttribute("inert"),t._trapFocus&&t.removeEventListener("keydown",t._trapFocus),document.removeEventListener("keydown",handlePanelEscapeKey),document.body.style.overflow="";const r=document.querySelector(`[data-panel-trigger="${e}"]`);r&&r.focus()}},handlePanelEscapeKey=e=>{if("Escape"===e.key){const e=document.querySelector(".side-panel.active");e&&closeSidePanel(e.id)}};document.addEventListener("click",e=>{const t=e.target.closest("[data-panel-trigger]");if(t)return void openSidePanel(t.dataset.panelTrigger);const s=e.target.closest("[data-panel-close]");if(s)closeSidePanel(s.dataset.panelClose);else if("panel-overlay"===e.target.id&&e.target.classList.contains("active")){const e=document.querySelector(".side-panel.active");e&&closeSidePanel(e.id)}}),window.openSidePanel=openSidePanel,window.closeSidePanel=closeSidePanel;const lazyLoadImages=()=>{const e=document.querySelectorAll("img[data-src]"),t=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const s=e.target;s.src=s.dataset.src,s.removeAttribute("data-src"),t.unobserve(s)}})});e.forEach(e=>t.observe(e))};let ticking=!1;const handleScroll=()=>{ticking||(requestAnimationFrame(()=>{handleNavbarScroll(),highlightNavOnScroll(),handleBackToTop(),ticking=!1}),ticking=!0)},prefersReducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)").matches,init=()=>{initTheme(),prefersReducedMotion||(animateElements(),initializeTimeline()),lazyLoadImages(),window.addEventListener("scroll",handleScroll,{passive:!0}),handleNavbarScroll(),highlightNavOnScroll(),handleBackToTop()};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",init):init();class NetflixCarousel{constructor(){this.carousel=document.querySelector(".netflix-carousel"),this.carousel&&(this.track=this.carousel.querySelector(".netflix-carousel__track"),this.cards=Array.from(this.carousel.querySelectorAll(".netflix-card")),this.arrowLeft=this.carousel.querySelector(".netflix-carousel__arrow--left"),this.arrowRight=this.carousel.querySelector(".netflix-carousel__arrow--right"),this.dots=Array.from(this.carousel.querySelectorAll(".netflix-carousel__dot")),this.years=Array.from(this.carousel.querySelectorAll(".netflix-timeline__year")),this.progressBar=this.carousel.querySelector(".netflix-timeline__progress"),this.currentIndex=0,this.totalCards=this.cards.length,this.touchStartX=0,this.touchEndX=0,this.swipeThreshold=50,this.isHovered=!1,this.init())}init(){this.carousel&&(this.navigate(0),this.arrowLeft&&this.arrowLeft.addEventListener("click",()=>{const e=this.currentIndex<=0?this.totalCards-1:this.currentIndex-1;this.navigate(e)}),this.arrowRight&&this.arrowRight.addEventListener("click",()=>{const e=this.currentIndex>=this.totalCards-1?0:this.currentIndex+1;this.navigate(e)}),this.cards.forEach(e=>{const t=e.querySelector(".netflix-card__expand");t&&t.addEventListener("click",t=>{t.stopPropagation(),this.toggleExpand(e)})}),this.dots.forEach(e=>{e.addEventListener("click",()=>{const t=parseInt(e.dataset.index,10);this.navigate(t)})}),this.years.forEach(e=>{e.addEventListener("click",()=>{const t=parseInt(e.dataset.index,10);this.navigate(t)})}),this.handleKeyboard(),this.handleSwipe(),this.carousel.addEventListener("mouseenter",()=>{this.isHovered=!0}),this.carousel.addEventListener("mouseleave",()=>{this.isHovered=!1}))}navigate(e){e<0||e>=this.totalCards||(this.currentIndex=e,this.cards.forEach((t,s)=>{s===e?t.classList.add("netflix-card--active"):t.classList.remove("netflix-card--active")}),this.scrollToCard(e),this.updateDots(e),this.updateTimeline(e),this.updateArrows(e))}scrollToCard(e){if(!this.track||!this.cards[e])return;const t=this.cards[e],s=(this.track.getBoundingClientRect(),t.getBoundingClientRect(),t.offsetLeft+t.offsetWidth/2-this.track.clientWidth/2);this.track.scrollTo({left:s,behavior:"smooth"})}toggleExpand(e){const t=e.classList.contains("netflix-card--expanded"),s=e.querySelector(".netflix-card__expand"),a=e.querySelector(".netflix-card__details");if(t||this.collapseAll(),e.classList.toggle("netflix-card--expanded"),s){const t=e.classList.contains("netflix-card--expanded");s.setAttribute("aria-expanded",t.toString()),s.textContent=t?"Chiudi":"Scopri di più"}if(a){const t=e.classList.contains("netflix-card--expanded");a.setAttribute("aria-hidden",(!t).toString())}}collapseAll(){this.cards.forEach(e=>{e.classList.remove("netflix-card--expanded");const t=e.querySelector(".netflix-card__expand");t&&(t.setAttribute("aria-expanded","false"),t.textContent="Scopri di più");const s=e.querySelector(".netflix-card__details");s&&s.setAttribute("aria-hidden","true")})}updateDots(e){this.dots.forEach((t,s)=>{s===e?t.classList.add("netflix-carousel__dot--active"):t.classList.remove("netflix-carousel__dot--active")})}updateTimeline(e){if(this.years.forEach((t,s)=>{s===e?t.classList.add("netflix-timeline__year--active"):t.classList.remove("netflix-timeline__year--active")}),this.progressBar){const t=this.totalCards-1,s=t>0?e/t*100:0;this.progressBar.style.width=`${s}%`}}updateArrows(e){this.arrowLeft&&(0===e?(this.arrowLeft.style.opacity="0.3",this.arrowLeft.style.pointerEvents="none"):(this.arrowLeft.style.opacity="1",this.arrowLeft.style.pointerEvents="auto")),this.arrowRight&&(e===this.totalCards-1?(this.arrowRight.style.opacity="0.3",this.arrowRight.style.pointerEvents="none"):(this.arrowRight.style.opacity="1",this.arrowRight.style.pointerEvents="auto"))}handleSwipe(){this.track&&(this.track.addEventListener("touchstart",e=>{this.touchStartX=e.changedTouches[0].screenX},{passive:!0}),this.track.addEventListener("touchend",e=>{this.touchEndX=e.changedTouches[0].screenX;const t=this.touchStartX-this.touchEndX;if(Math.abs(t)>=this.swipeThreshold)if(t>0){const e=this.currentIndex>=this.totalCards-1?0:this.currentIndex+1;this.navigate(e)}else{const e=this.currentIndex<=0?this.totalCards-1:this.currentIndex-1;this.navigate(e)}},{passive:!0}))}handleKeyboard(){document.addEventListener("keydown",e=>{if(this.carousel.contains(document.activeElement)||this.isHovered)switch(e.key){case"ArrowLeft":e.preventDefault();const t=this.currentIndex<=0?this.totalCards-1:this.currentIndex-1;this.navigate(t);break;case"ArrowRight":e.preventDefault();const s=this.currentIndex>=this.totalCards-1?0:this.currentIndex+1;this.navigate(s);break;case"Escape":this.collapseAll()}})}}const initNetflixCarousel=()=>{document.querySelector(".netflix-carousel")&&new NetflixCarousel};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initNetflixCarousel):initNetflixCarousel();